cmake_minimum_required(VERSION 3.16)
project(RemoteAccessSystem VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# Build options
option(BUILD_COMMON "Build common library" ON)
option(BUILD_USB_CLIENT "Build USB client" ON)
option(BUILD_PC_CLIENT "Build PC client" ON)
option(BUILD_ACCOUNT_SERVER "Build account server" ON)
option(BUILD_RELAY_SERVER "Build relay server" ON)
option(BUILD_MOBILE_APP "Build mobile app" ON)
option(BUILD_TESTS "Build tests" OFF)

# Find required packages
find_package(ACE REQUIRED)
find_package(TAO REQUIRED)
find_package(OpenSSL REQUIRED)
find_package(SQLite3 REQUIRED)
find_package(Threads REQUIRED)

# Add subdirectories
if(BUILD_COMMON)
    add_subdirectory(common)
endif()

if(BUILD_USB_CLIENT)
    add_subdirectory(usb-client)
endif()

if(BUILD_PC_CLIENT)
    add_subdirectory(pc-client)
endif()

if(BUILD_ACCOUNT_SERVER)
    add_subdirectory(account-server)
endif()

if(BUILD_RELAY_SERVER)
    add_subdirectory(relay-server)
endif()

if(BUILD_MOBILE_APP)
    find_package(Qt6 COMPONENTS Core Quick Widgets Network REQUIRED)
    add_subdirectory(mobile-app)
endif()

if(BUILD_TESTS)
    enable_testing()
    add_subdirectory(tests)
endif()

# Install targets
install(DIRECTORY scripts/ 
    DESTINATION bin
    USE_SOURCE_PERMISSIONS
    PATTERN "*.sh")

install(FILES README.md LICENSE 
    DESTINATION share/doc/remote-access-system)